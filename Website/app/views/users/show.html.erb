<% provide(:title, @user.name) %>
<div id="theRed">

	<h1><a href="#"><%= @user.name %></a></h1>
	<h2><%= "Dropbox Mail "%><br>
	<%=@account_info['email'] %></h2>
</div>


<div class="row">

	<div class="col-md-3">
		<form class="navbar-form" enctype="multipart/form-data" role="upload" accept-charset="UTF-8" action="/users/upload" method="post">
			<div class="form-group">
				<input name="utf8" type="hidden" value="✓">
				<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
				<input type="file" class="form-control" placeholder="Choose file" name="file" id="file" style="width: 15.47em">
				<input type="text" class="form-control" placeholder="Write the path" name="path" id="path">
				<button type="submit" class="btn btn-danger" ><span class="glyphicon glyphicon-upload" aria-hidden="true"></span></button>
			</div>
		</form>


		<form class="navbar-form" role="search" accept-charset="UTF-8" action="/users/search" data-remote="true" method="post">
			<div class="form-group">
				<input name="utf8" type="hidden" value="✓">
				<input type="text" class="form-control" placeholder="Search" name="query" id="query">
				<button type="submit" class="btn btn-danger" ><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
			</div>
		</form>

		<form class="navbar-form" role="create" accept-charset="UTF-8" action="/users/folder_gdeed" data-remote="true"  method="post">
			<div class="form-group">
				<input name="utf8" type="hidden" value="✓">
				<input type="text" class="form-control" placeholder="Write the path" name="path" id="path">
				<button type="submit" class="btn btn-danger" id="gdeed"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span></button>
			</div>
		</form>

	</div>

	<script type="text/javascript">
		$('#gdeed').click(function() {
			location.reload();
		});
	</script>


	<div class="col-md-9">
		<div id="lol">
			<ul class="list-group">
				<div>
					<% @metadata["contents"].each do |key, value| %>
						<li class="list-group-item">
							<% if (key["is_dir"]) %>
								<%= "<span class='glyphicon glyphicon-folder-open'></span>".html_safe %>
								<%= link_to key["path"][1..-1], dropbox_change_path(path: key["path"]), :remote => true %>
							<%else %>
								<%= "<span class='glyphicon glyphicon-file'></span>".html_safe %>
								<%= key["path"][1..-1]%>
								<%= link_to "[#{key["size"]} <span class='glyphicon glyphicon-cloud-download'></span>]".html_safe, dropbox_download_path(path: key["path"]), :target => "_blank"%>
							<%end%>
						</li>
					<%end%>
				</div>
			</ul>
		</div>
	</div>

</div>

<% unless params[:path] == '/' || params[:path] == nil %>
	<!-- If we're not at the root page or if the path paramter is not empty -->
	<% new_path = params[:path][0..(params[:path].rindex(params[:path].split('/')[-1])) - 1 ] %>
	<!-- Oh boy, this is complicated. Assume we have a path abc/xyz. When we press the back button, we need to strip the path to just abc. The above code eliminates all characters after the last slash, including the slash itself. rindex helps you to find the rightmost index for a certain substring, in our case, "xyx"), and then we delete it. -->
	<%= link_to "Go back", dropbox_change_path(path: new_path) , remote: true%>
	<!-- Using AJAX, we call the change path action with the new path passed in as the parameter -->
<% end %>